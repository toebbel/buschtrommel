/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * MainFrame.java
 *
 * Created on 02.01.2013, 19:15:29
 */
package de.tr0llhoehle.buschtrommel.gui;

import de.tr0llhoehle.buschtrommel.Buschtrommel;
import de.tr0llhoehle.buschtrommel.IGUICallbacks;
import de.tr0llhoehle.buschtrommel.models.Host;
import de.tr0llhoehle.buschtrommel.models.ShareAvailability;
import de.tr0llhoehle.buschtrommel.network.ITransferProgress;
import de.tr0llhoehle.buschtrommel.network.ITransferProgress.TransferStatus;
import de.tr0llhoehle.buschtrommel.network.ITransferProgress.TransferType;
import de.tr0llhoehle.buschtrommel.network.IncomingDownload;
import de.tr0llhoehle.buschtrommel.network.OutgoingTransfer;
import de.tr0llhoehle.buschtrommel.test.mockups.ITransferMock;

import javax.swing.DefaultListModel;
import javax.swing.JList;
import javax.swing.JOptionPane;
import javax.swing.ListCellRenderer;
import javax.swing.ListModel;
import javax.swing.table.DefaultTableModel;

import java.awt.Component;
import java.awt.Window.Type;
import java.awt.Toolkit;
import java.io.File;
import java.io.FileReader;
import java.io.IOException;
import java.net.InetSocketAddress;
import java.util.List;
import java.util.logging.Handler;
import java.util.logging.Level;
import java.util.logging.Logger;

/**
 * 
 * @author benjamin
 */
public class MainFrame extends javax.swing.JFrame implements IGUICallbacks {

	private DefaultListModel<ITransferProgress> listmodel = new DefaultListModel<ITransferProgress>();
	private DownloadItem downloadCellRenderer = new DownloadItem();
	private Buschtrommel buschtrommel;
	private FilesTableModel tablemodel = new FilesTableModel();
	private LocalSharesTableModel sharesModel = new LocalSharesTableModel();
	private String downloadPath = null;
	private String defaultTtl = "-1";

	/**
	 * Creates new form MainFrame
	 */
	public MainFrame() {
		setIconImage(Toolkit.getDefaultToolkit().getImage(
				MainFrame.class.getResource("/de/tr0llhoehle/buschtrommel/gui/res/djembe.png")));
		setTitle("Bongo");
		initComponents();

		buschtrommel = new Buschtrommel(this, "Bongo" + Math.random());
		try {
			buschtrommel.start();
		} catch (IOException ex) {
			Logger.getLogger(MainFrame.class.getName()).log(Level.SEVERE, null, ex);
		}
		filesHostsTable.setAutoCreateRowSorter(true);
		localSharesTable.setModel(sharesModel);
		localSharesTable.setAutoCreateRowSorter(true);
		// filesHostsTable.setModel(tablemodel);
		// tablemodel.addMock("bla", "meta-information", "42", "üch", "ff::ff",
		// "trölf", "-1");
		// tablemodel.addMock("arrrr", "larp", "300000", "üch", "ff::ff",
		// "trölf", "-1");

	}

	/**
	 * This method is called from within the constructor to initialize the form.
	 * WARNING: Do NOT modify this code. The content of this method is always
	 * regenerated by the Form Editor.
	 */
	@SuppressWarnings("unchecked")
	// <editor-fold defaultstate="collapsed"
	// <editor-fold defaultstate="collapsed"
	// <editor-fold defaultstate="collapsed"
	// <editor-fold defaultstate="collapsed"
	// desc="Generated Code">//GEN-BEGIN:initComponents
	private void initComponents() {

		jFileChooser1 = new javax.swing.JFileChooser();
		jTabbedPane1 = new javax.swing.JTabbedPane();
		jPanel1 = new javax.swing.JPanel();
		jScrollPane3 = new javax.swing.JScrollPane();
		filesHostsTable = new javax.swing.JTable();
		downloadFilesBtn = new javax.swing.JButton();
		downloadFilesBtn1 = new javax.swing.JButton();
		jPanel3 = new javax.swing.JPanel();
		addShare = new javax.swing.JButton();
		removeShare = new javax.swing.JButton();
		jScrollPane2 = new javax.swing.JScrollPane();
		localSharesTable = new javax.swing.JTable();
		activateShare = new javax.swing.JButton();
		jPanel4 = new javax.swing.JPanel();
		jScrollPane1 = new javax.swing.JScrollPane();
		activeTransferList = new javax.swing.JList(listmodel);
		abortTransfer = new javax.swing.JButton();
		resetTransfer = new javax.swing.JButton();
		resumeTransfer = new javax.swing.JButton();
		jPanel5 = new javax.swing.JPanel();
		saveSettings = new javax.swing.JButton();
		jTextField1 = new javax.swing.JTextField();
		jLabel1 = new javax.swing.JLabel();
		loadSettings = new javax.swing.JButton();
		jTextField2 = new javax.swing.JTextField();
		jLabel2 = new javax.swing.JLabel();
		downloadFolder = new javax.swing.JTextField();
		jLabel3 = new javax.swing.JLabel();
		jButton1 = new javax.swing.JButton();

		jFileChooser1.setDialogTitle("Datei wählen");

		setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);

		jTabbedPane1.setName("files-table"); // NOI18N

		jPanel1.setName("filesTab"); // NOI18N

		filesHostsTable.setModel(tablemodel);
		jScrollPane3.setViewportView(filesHostsTable);

		downloadFilesBtn.setText("Download selected Files");
		downloadFilesBtn.addActionListener(new java.awt.event.ActionListener() {
			public void actionPerformed(java.awt.event.ActionEvent evt) {
				downloadFilesBtnActionPerformed(evt);
			}
		});

		downloadFilesBtn1.setText("Download selected Files (Multihost)");
		downloadFilesBtn1.addActionListener(new java.awt.event.ActionListener() {
			public void actionPerformed(java.awt.event.ActionEvent evt) {
				downloadFilesBtn1ActionPerformed(evt);
			}
		});

		javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
		jPanel1.setLayout(jPanel1Layout);
		jPanel1Layout
				.setHorizontalGroup(jPanel1Layout
						.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
						.addGroup(
								jPanel1Layout
										.createSequentialGroup()
										.addGroup(
												jPanel1Layout
														.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
														.addGroup(
																jPanel1Layout
																		.createSequentialGroup()
																		.addContainerGap()
																		.addComponent(downloadFilesBtn)
																		.addPreferredGap(
																				javax.swing.LayoutStyle.ComponentPlacement.RELATED)
																		.addComponent(downloadFilesBtn1)
																		.addGap(0, 0, Short.MAX_VALUE))
														.addComponent(jScrollPane3,
																javax.swing.GroupLayout.Alignment.TRAILING,
																javax.swing.GroupLayout.DEFAULT_SIZE, 780,
																Short.MAX_VALUE)).addContainerGap()));
		jPanel1Layout.setVerticalGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
				.addGroup(
						javax.swing.GroupLayout.Alignment.TRAILING,
						jPanel1Layout
								.createSequentialGroup()
								.addContainerGap()
								.addComponent(jScrollPane3, javax.swing.GroupLayout.DEFAULT_SIZE, 583, Short.MAX_VALUE)
								.addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
								.addGroup(
										jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
												.addComponent(downloadFilesBtn).addComponent(downloadFilesBtn1))
								.addContainerGap()));

		jTabbedPane1.addTab("Hosts & Files", jPanel1);

		jPanel3.setName("sharesTab"); // NOI18N

		addShare.setText("Add new Share");
		addShare.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
		addShare.addActionListener(new java.awt.event.ActionListener() {
			public void actionPerformed(java.awt.event.ActionEvent evt) {
				addShareActionPerformed(evt);
			}
		});

		removeShare.setText("Remove Share");
		removeShare.addActionListener(new java.awt.event.ActionListener() {
			public void actionPerformed(java.awt.event.ActionEvent evt) {
				removeShareActionPerformed(evt);
				removeShareActionPerformed1(evt);
			}
		});

		jScrollPane2.setName("shares-table"); // NOI18N

		localSharesTable.setModel(sharesModel);
		localSharesTable.setName(""); // NOI18N
		jScrollPane2.setViewportView(localSharesTable);

		activateShare.setText("activate Share");
		activateShare.addActionListener(new java.awt.event.ActionListener() {
			public void actionPerformed(java.awt.event.ActionEvent evt) {
				activateShareActionPerformed(evt);
				activateShareActionPerformed1(evt);
			}
		});

		javax.swing.GroupLayout jPanel3Layout = new javax.swing.GroupLayout(jPanel3);
		jPanel3.setLayout(jPanel3Layout);
		jPanel3Layout.setHorizontalGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
				.addGroup(
						javax.swing.GroupLayout.Alignment.TRAILING,
						jPanel3Layout
								.createSequentialGroup()
								.addComponent(jScrollPane2, javax.swing.GroupLayout.DEFAULT_SIZE, 655, Short.MAX_VALUE)
								.addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
								.addGroup(
										jPanel3Layout
												.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
												.addGroup(
														jPanel3Layout
																.createParallelGroup(
																		javax.swing.GroupLayout.Alignment.LEADING,
																		false)
																.addComponent(removeShare,
																		javax.swing.GroupLayout.DEFAULT_SIZE,
																		javax.swing.GroupLayout.DEFAULT_SIZE,
																		Short.MAX_VALUE)
																.addComponent(addShare,
																		javax.swing.GroupLayout.DEFAULT_SIZE,
																		javax.swing.GroupLayout.DEFAULT_SIZE,
																		Short.MAX_VALUE)).addComponent(activateShare))
								.addContainerGap()));
		jPanel3Layout
				.setVerticalGroup(jPanel3Layout
						.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
						.addGroup(
								jPanel3Layout
										.createSequentialGroup()
										.addContainerGap()
										.addGroup(
												jPanel3Layout
														.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
														.addComponent(jScrollPane2,
																javax.swing.GroupLayout.DEFAULT_SIZE, 619,
																Short.MAX_VALUE)
														.addGroup(
																jPanel3Layout
																		.createSequentialGroup()
																		.addComponent(addShare)
																		.addPreferredGap(
																				javax.swing.LayoutStyle.ComponentPlacement.RELATED)
																		.addComponent(activateShare).addGap(18, 18, 18)
																		.addComponent(removeShare)
																		.addGap(0, 0, Short.MAX_VALUE)))
										.addContainerGap()));

		jTabbedPane1.addTab("Shares", jPanel3);

		jPanel4.setName("activeTransfersTab"); // NOI18N

		activeTransferList.setCellRenderer(downloadCellRenderer);
		jScrollPane1.setViewportView(activeTransferList);

		abortTransfer.setText("Abort");
		abortTransfer.addActionListener(new java.awt.event.ActionListener() {
			public void actionPerformed(java.awt.event.ActionEvent evt) {
				abortTransferActionPerformed(evt);
			}
		});

		resetTransfer.setText("Reset");
		resetTransfer.addActionListener(new java.awt.event.ActionListener() {
			public void actionPerformed(java.awt.event.ActionEvent evt) {
				resetTransferActionPerformed(evt);
			}
		});

		resumeTransfer.setText("Resume");
		resumeTransfer.addActionListener(new java.awt.event.ActionListener() {
			public void actionPerformed(java.awt.event.ActionEvent evt) {
				resumeTransferActionPerformed(evt);
			}
		});

		javax.swing.GroupLayout jPanel4Layout = new javax.swing.GroupLayout(jPanel4);
		jPanel4.setLayout(jPanel4Layout);
		jPanel4Layout.setHorizontalGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
				.addGroup(
						javax.swing.GroupLayout.Alignment.TRAILING,
						jPanel4Layout
								.createSequentialGroup()
								.addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 706, Short.MAX_VALUE)
								.addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
								.addGroup(
										jPanel4Layout
												.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
												.addComponent(resumeTransfer, javax.swing.GroupLayout.DEFAULT_SIZE,
														javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
												.addComponent(resetTransfer, javax.swing.GroupLayout.DEFAULT_SIZE,
														javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
												.addComponent(abortTransfer, javax.swing.GroupLayout.DEFAULT_SIZE,
														javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
								.addContainerGap()));
		jPanel4Layout
				.setVerticalGroup(jPanel4Layout
						.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
						.addGroup(
								jPanel4Layout
										.createSequentialGroup()
										.addGroup(
												jPanel4Layout
														.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
														.addGroup(
																jPanel4Layout
																		.createSequentialGroup()
																		.addContainerGap()
																		.addComponent(abortTransfer)
																		.addPreferredGap(
																				javax.swing.LayoutStyle.ComponentPlacement.RELATED)
																		.addComponent(resetTransfer)
																		.addPreferredGap(
																				javax.swing.LayoutStyle.ComponentPlacement.RELATED)
																		.addComponent(resumeTransfer)
																		.addGap(0, 0, Short.MAX_VALUE))
														.addComponent(jScrollPane1,
																javax.swing.GroupLayout.DEFAULT_SIZE, 631,
																Short.MAX_VALUE)).addContainerGap()));

		jTabbedPane1.addTab("active Transfers", jPanel4);

		jPanel5.setName("settingsTab"); // NOI18N

		saveSettings.setText("save Settings");
		saveSettings.setName("saveSettings_btn"); // NOI18N
		saveSettings.addActionListener(new java.awt.event.ActionListener() {
			public void actionPerformed(java.awt.event.ActionEvent evt) {
				saveSettingsActionPerformed(evt);
			}
		});

		jLabel1.setText("Path to Share-Settings");

		loadSettings.setText("load Settings");
		loadSettings.addActionListener(new java.awt.event.ActionListener() {
			public void actionPerformed(java.awt.event.ActionEvent evt) {
				loadSettingsActionPerformed(evt);
			}
		});

		jTextField2.setText("-1");
		jTextField2.setToolTipText("-1 = unlimited");

		jLabel2.setText("Default TTL");

		downloadFolder.setEditable(false);

		jLabel3.setText("Download Folder");

		jButton1.setText("select");
		jButton1.addActionListener(new java.awt.event.ActionListener() {
			public void actionPerformed(java.awt.event.ActionEvent evt) {
				jButton1ActionPerformed(evt);
			}
		});

		javax.swing.GroupLayout jPanel5Layout = new javax.swing.GroupLayout(jPanel5);
		jPanel5.setLayout(jPanel5Layout);
		jPanel5Layout
				.setHorizontalGroup(jPanel5Layout
						.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
						.addGroup(
								jPanel5Layout
										.createSequentialGroup()
										.addContainerGap()
										.addGroup(
												jPanel5Layout
														.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
														.addGroup(
																jPanel5Layout
																		.createSequentialGroup()
																		.addGap(0, 545, Short.MAX_VALUE)
																		.addComponent(loadSettings)
																		.addPreferredGap(
																				javax.swing.LayoutStyle.ComponentPlacement.RELATED)
																		.addComponent(saveSettings))
														.addGroup(
																jPanel5Layout
																		.createSequentialGroup()
																		.addGroup(
																				jPanel5Layout
																						.createParallelGroup(
																								javax.swing.GroupLayout.Alignment.LEADING)
																						.addComponent(jLabel1)
																						.addComponent(jLabel2)
																						.addComponent(jLabel3))
																		.addPreferredGap(
																				javax.swing.LayoutStyle.ComponentPlacement.RELATED)
																		.addGroup(
																				jPanel5Layout
																						.createParallelGroup(
																								javax.swing.GroupLayout.Alignment.LEADING)
																						.addGroup(
																								jPanel5Layout
																										.createSequentialGroup()
																										.addComponent(
																												downloadFolder)
																										.addPreferredGap(
																												javax.swing.LayoutStyle.ComponentPlacement.RELATED)
																										.addComponent(
																												jButton1))
																						.addComponent(jTextField2)
																						.addComponent(jTextField1))))
										.addContainerGap()));
		jPanel5Layout.setVerticalGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
				.addGroup(
						javax.swing.GroupLayout.Alignment.TRAILING,
						jPanel5Layout
								.createSequentialGroup()
								.addGap(22, 22, 22)
								.addGroup(
										jPanel5Layout
												.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
												.addComponent(jTextField1, javax.swing.GroupLayout.PREFERRED_SIZE,
														javax.swing.GroupLayout.DEFAULT_SIZE,
														javax.swing.GroupLayout.PREFERRED_SIZE).addComponent(jLabel1))
								.addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
								.addGroup(
										jPanel5Layout
												.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
												.addComponent(jTextField2, javax.swing.GroupLayout.PREFERRED_SIZE,
														javax.swing.GroupLayout.DEFAULT_SIZE,
														javax.swing.GroupLayout.PREFERRED_SIZE).addComponent(jLabel2))
								.addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
								.addGroup(
										jPanel5Layout
												.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
												.addComponent(downloadFolder, javax.swing.GroupLayout.PREFERRED_SIZE,
														javax.swing.GroupLayout.DEFAULT_SIZE,
														javax.swing.GroupLayout.PREFERRED_SIZE).addComponent(jLabel3)
												.addComponent(jButton1))
								.addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 481,
										Short.MAX_VALUE)
								.addGroup(
										jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
												.addComponent(saveSettings).addComponent(loadSettings))
								.addContainerGap()));

		saveSettings.getAccessibleContext().setAccessibleName("save_Settings");

		jTabbedPane1.addTab("Settings", jPanel5);

		javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
		getContentPane().setLayout(layout);
		layout.setHorizontalGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGroup(
				layout.createSequentialGroup().addContainerGap().addComponent(jTabbedPane1)));
		layout.setVerticalGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGroup(
				layout.createSequentialGroup().addContainerGap().addComponent(jTabbedPane1)));

		jTabbedPane1.getAccessibleContext().setAccessibleName("");

		pack();
	}// </editor-fold>//GEN-END:initComponents

	private void activateShareActionPerformed(java.awt.event.ActionEvent evt) {// GEN-FIRST:event_activateShareActionPerformed
		int selected[] = localSharesTable.getSelectedRows();
		for (int i : selected) {
			sharesModel.getValueAt(i, 0);

			if (buschtrommel != null) {
				// "Filename", "Meta-Information", "Path", "Size","TTL"
				int ttl = Integer.parseInt(sharesModel.getValueAt(i, 4));

				try {
					buschtrommel.AddFileToShare(sharesModel.getValueAt(i, 3), sharesModel.getValueAt(i, 0),
							sharesModel.getValueAt(i, 1), ttl);
				} catch (IllegalArgumentException e) {
					// TODO Auto-generated catch block
					JOptionPane.showMessageDialog(null, "Woops, something went terribly wrong");
					sharesModel.removeShare(i);
				} catch (IOException e) {
					// TODO Auto-generated catch block
					JOptionPane.showMessageDialog(null, "Woops, something went terribly wrong");
					sharesModel.removeShare(i);
				}
			}
		}
	}// GEN-LAST:event_activateShareActionPerformed

	private void activateShareActionPerformed1(java.awt.event.ActionEvent evt) {// GEN-FIRST:event_activateShareActionPerformed1
		// TODO add your handling code here:
	}// GEN-LAST:event_activateShareActionPerformed1

	private void downloadFilesBtn1ActionPerformed(java.awt.event.ActionEvent evt) {// GEN-FIRST:event_downloadFilesBtn1ActionPerformed
		if (downloadPath == null) {
			JOptionPane.showMessageDialog(null, "Please set a Download-Folder first");
			return;
		}

		int[] selected = filesHostsTable.getSelectedRows();

		for (int i : selected) {
			// "Filename", "Meta-Information", "Size", "Host-Name","IP", "Hash",
			// "TTL"
			String hash = tablemodel.getValueAt(i, 5);
			String ip = tablemodel.getValueAt(i, 4);
			String name = tablemodel.getValueAt(i, 0);
			if (buschtrommel != null) {
				Host host = buschtrommel.getHosts().get(ip);
				ITransferProgress progress = buschtrommel.DownloadFile(hash, downloadPath + "/" + name, host);
				listmodel.addElement(progress);
			}
		}

	}// GEN-LAST:event_downloadFilesBtn1ActionPerformed

	private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {// GEN-FIRST:event_jButton1ActionPerformed
		jFileChooser1.setFileSelectionMode(jFileChooser1.DIRECTORIES_ONLY);
		int returnVal = jFileChooser1.showOpenDialog(this);
		if (returnVal == jFileChooser1.APPROVE_OPTION) {
			File file = jFileChooser1.getSelectedFile();
			// try {
			// What to do with the file, e.g. display it in a TextArea
			// textarea.read( new FileReader( file.getAbsolutePath() ), null );
			downloadPath = file.getAbsolutePath();
			downloadFolder.setText(downloadPath);

			// System.out.println(file.getAbsolutePath());
			// System.out.println( new FileReader( file.getAbsolutePath() ),
			// null );
			// } catch (IOException ex) {
			// System.out.println("problem accessing file"+file.getAbsolutePath());
			// }
		} else {
			System.out.println("File access cancelled by user.");
		}

	}// GEN-LAST:event_jButton1ActionPerformed

	private void saveSettingsActionPerformed(java.awt.event.ActionEvent evt) {// GEN-FIRST:event_saveSettingsActionPerformed
		// TODO add your handling code here:
	}// GEN-LAST:event_saveSettingsActionPerformed

	private void downloadFilesBtnActionPerformed(java.awt.event.ActionEvent evt) {// GEN-FIRST:event_downloadFilesBtnActionPerformed
		if (downloadPath == null) {
			JOptionPane.showMessageDialog(null, "Please set a Download-Folder first");
			return;
		}

		int[] selected = filesHostsTable.getSelectedRows();

		for (int i : selected) {
			// "Filename", "Meta-Information", "Size", "Host-Name","IP", "Hash",
			// "TTL"
			String hash = tablemodel.getValueAt(i, 5);
			String ip = tablemodel.getValueAt(i, 4);
			String name = tablemodel.getValueAt(i, 0);
			if (buschtrommel != null) {
				Host host = buschtrommel.getHosts().get(ip);
				ITransferProgress progress = buschtrommel.DownloadFile(hash, downloadPath + "/" + name);
				listmodel.addElement(progress);
			}
		}
	}// GEN-LAST:event_downloadFilesBtnActionPerformed

	private void removeShareActionPerformed(java.awt.event.ActionEvent evt) {// GEN-FIRST:event_removeShareActionPerformed
		int selected[] = localSharesTable.getSelectedRows();
		for (int i : selected) {
			sharesModel.getValueAt(i, 0);

			if (buschtrommel != null) {
				sharesModel.removeShare(i);

				
			}
		}
	}// GEN-LAST:event_removeShareActionPerformed

	private void loadSettingsActionPerformed(java.awt.event.ActionEvent evt) {// GEN-FIRST:event_loadSettingsActionPerformed
		// TODO add your handling code here:
	}// GEN-LAST:event_loadSettingsActionPerformed

	private void removeShareActionPerformed1(java.awt.event.ActionEvent evt) {// GEN-FIRST:event_removeShareActionPerformed1
	}// GEN-LAST:event_removeShareActionPerformed1

	private void addShareActionPerformed(java.awt.event.ActionEvent evt) {// GEN-FIRST:event_addShareActionPerformed

		jFileChooser1.setFileSelectionMode(jFileChooser1.FILES_ONLY);

		int returnVal = jFileChooser1.showOpenDialog(this);
		if (returnVal == jFileChooser1.APPROVE_OPTION) {
			File file = jFileChooser1.getSelectedFile();
			// try {
			// What to do with the file, e.g. display it in a TextArea
			// textarea.read( new FileReader( file.getAbsolutePath() ), null );

			sharesModel.addShare(file.getName(), file.getAbsolutePath(), String.valueOf(file.length()), defaultTtl);
			// System.out.println(file.getAbsolutePath());
			// System.out.println( new FileReader( file.getAbsolutePath() ),
			// null );
			// } catch (IOException ex) {
			// System.out.println("problem accessing file"+file.getAbsolutePath());
			// }
		} else {
			System.out.println("File access cancelled by user.");
		}
	}// GEN-LAST:event_addShareActionPerformed

	private void resumeTransferActionPerformed(java.awt.event.ActionEvent evt) {// GEN-FIRST:event_resumeTransferActionPerformed
		// TODO add your handling code here:
	}// GEN-LAST:event_resumeTransferActionPerformed

	private void resetTransferActionPerformed(java.awt.event.ActionEvent evt) {// GEN-FIRST:event_resetTransferActionPerformed
		// TODO add your handling code here:
		int items_to_delete[] = null;
		if (!activeTransferList.isSelectionEmpty()) {
			items_to_delete = activeTransferList.getSelectedIndices();
		} else {
			return;
		}

		if (items_to_delete != null) {

			for (int i = items_to_delete.length - 1; i >= 0; i--) {
				// System.out.println("deleting: " + items_to_delete[i]);
				listmodel.remove(items_to_delete[i]);
			}
			// list.setListData(items);
		}

	}// GEN-LAST:event_resetTransferActionPerformed

	private void abortTransferActionPerformed(java.awt.event.ActionEvent evt) {// GEN-FIRST:event_abortTransferActionPerformed
		// TODO add your handling code here:
		// TODO add testtransfer

		// JOptionPane.showMessageDialog(this, "Pressed", "Nachricht",
		// JOptionPane.INFORMATION_MESSAGE);

		// ITransferMock mock[] = new ITransferMock[1];
		ITransferMock mock = new ITransferMock("Test", true, new Long(100), new Long((int) (Math.random() * 100)),
				TransferStatus.Transfering);

		listmodel.addElement(mock);
		// new Component

		// DefaultListModel<ITransferProgress> listmodel = new
		// DefaultListModel<ITransferProgress>();
		// ((DefaultListModel<ITransferProgress>) listmodel).addElement(mock);

		// activeTransferList.s
		// activeTransferList.setListData(mock);// = new
		// JList<ITransferProgress>(listmodel);

	}// GEN-LAST:event_abortTransferActionPerformed

	/**
	 * @param args
	 *            the command line arguments
	 */
	public static void main(String args[]) {
		/* Set the Sytem look and feel */
		// <editor-fold defaultstate="collapsed"
		// desc=" Look and feel setting code (optional) ">
		/*
		 * If Nimbus (introduced in Java SE 6) is not available, stay with the
		 * default look and feel. For details see
		 * http://download.oracle.com/javase
		 * /tutorial/uiswing/lookandfeel/plaf.html
		 */
		try {
			javax.swing.UIManager.setLookAndFeel(javax.swing.UIManager.getSystemLookAndFeelClassName());
			// for (javax.swing.UIManager.LookAndFeelInfo info :
			// javax.swing.UIManager.getInstalledLookAndFeels()) {
			// if ("Nimbus".equals(info.getName())) {
			// javax.swing.UIManager.setLookAndFeel(info.getClassName());
			// break;
			// }
			// }
		} catch (ClassNotFoundException ex) {
			java.util.logging.Logger.getLogger(MainFrame.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
		} catch (InstantiationException ex) {
			java.util.logging.Logger.getLogger(MainFrame.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
		} catch (IllegalAccessException ex) {
			java.util.logging.Logger.getLogger(MainFrame.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
		} catch (javax.swing.UnsupportedLookAndFeelException ex) {
			java.util.logging.Logger.getLogger(MainFrame.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
		}
		// </editor-fold>

		/* Create and display the form */
		java.awt.EventQueue.invokeLater(new Runnable() {
			public void run() {
				new MainFrame().setVisible(true);

			}
		});
	}

	// Variables declaration - do not modify//GEN-BEGIN:variables
	private javax.swing.JButton abortTransfer;
	private javax.swing.JButton activateShare;
	private javax.swing.JList activeTransferList;
	private javax.swing.JButton addShare;
	private javax.swing.JButton downloadFilesBtn;
	private javax.swing.JButton downloadFilesBtn1;
	private javax.swing.JTextField downloadFolder;
	private javax.swing.JTable filesHostsTable;
	private javax.swing.JButton jButton1;
	private javax.swing.JFileChooser jFileChooser1;
	private javax.swing.JLabel jLabel1;
	private javax.swing.JLabel jLabel2;
	private javax.swing.JLabel jLabel3;
	private javax.swing.JPanel jPanel1;
	private javax.swing.JPanel jPanel3;
	private javax.swing.JPanel jPanel4;
	private javax.swing.JPanel jPanel5;
	private javax.swing.JScrollPane jScrollPane1;
	private javax.swing.JScrollPane jScrollPane2;
	private javax.swing.JScrollPane jScrollPane3;
	private javax.swing.JTabbedPane jTabbedPane1;
	private javax.swing.JTextField jTextField1;
	private javax.swing.JTextField jTextField2;
	private javax.swing.JButton loadSettings;
	private javax.swing.JTable localSharesTable;
	private javax.swing.JButton removeShare;
	private javax.swing.JButton resetTransfer;
	private javax.swing.JButton resumeTransfer;
	private javax.swing.JButton saveSettings;

	// End of variables declaration//GEN-END:variables

	@Override
	public void newHostDiscovered(Host host) {
		tablemodel.newHostDiscovered(host);
		// throw new UnsupportedOperationException("Not supported yet.");
	}

	@Override
	public void hostWentOffline(Host host) {
		tablemodel.hostWentOffline(host);
		// throw new UnsupportedOperationException("Not supported yet.");
	}

	@Override
	public void removeShare(ShareAvailability file) {
		tablemodel.removeShare(file);
		// throw new UnsupportedOperationException("Not supported yet.");
	}

	@Override
	public void fileTransferComplete(ITransferProgress transferProgress) {
		throw new UnsupportedOperationException("Not supported yet.");
	}

	@Override
	public void fileTransferFailed(ITransferProgress transferProgress) {
		throw new UnsupportedOperationException("Not supported yet.");
	}

	@Override
	public void newShareAvailable(ShareAvailability file) {
		// filesHostsTable.setModel(filesModel);
		tablemodel.addShare(file);
		// throw new UnsupportedOperationException("Not supported yet.");
	}

	@Override
	public void updatedTTL(ShareAvailability file) {
		throw new UnsupportedOperationException("Not supported yet.");
	}
}
